---
title: "Data Mining Assignment 2"
output: html_notebook
---

```{r}
path <- "C:/users/koenn/Google Drive/DM/Practical/DMA2"
```

Load libraries
```{r, message=FALSE, warning=FALSE}
library(rpart)
library(rpart.plot)
library(randomForest)
library(glmnet)
```

Load the text files into memory
```{r}
library(tm)
topDirs <- dir(file.path(path, 'Reviews'))
for(top in topDirs) {
  foldDirs <- dir(file.path(path, 'Reviews', top), pattern='fold[[:alnum:]]')
  for(i in foldDirs) {
    read_path <- file.path(path, 'Reviews', top, i)
    assign(paste0(top, "_", i), VCorpus(DirSource(read_path, encoding="UTF-8")))
  }
}
train_truth <- c(truthful_fold1, truthful_fold2, truthful_fold3, truthful_fold4)
train_decep <- c(deceptive_fold1, deceptive_fold2, deceptive_fold3, deceptive_fold4)
train <- c(train_truth, train_decep)
test <- c(truthful_fold5, deceptive_fold5)
```

Preprocess the text corpus and create a document-term matrix
```{r}
train <- tm_map(train, removePunctuation)
train <- tm_map(train, PlainTextDocument)
train <- tm_map(train, removeWords, stopwords("english"))
train <- tm_map(train, removeNumbers)
train <- tm_map(train, stripWhitespace)
train <- tm_map(train, stemDocument)
index.neg <- sample(12500, 8000)
index.pos <- sample(12500+sample(12500, 8000))
index.train <- c(index.neg, index.pos)
train.dtm <- DocumentTermMatrix(train[index.train]) # Throws error due to cleaning
```

``` {r}
train.mnb <- function (dtm,labels) {
  call <- match.call()
  V <- ncol(dtm)
  N <- nrow(dtm)
  prior <- table(labels)/N
  labelnames <- names(prior)
  nclass <- length(prior)
  cond.probs <- matrix(nrow=V,ncol=nclass)
  dimnames(cond.probs)[[1]] <- dimnames(dtm)[[2]]
  dimnames(cond.probs)[[2]] <- labelnames
  index <- list(length=nclass)
  for(j in 1:nclass){
    index[[j]] <- c(1:N)[labels == labelnames[j]]
  }
  
  for(i in 1:V){
    for(j in 1:nclass){
      cond.probs[i,j] <- (sum(dtm[index[[j]],i])+1)/(sum(dtm[index[[j]],])+V)
    }
  }
  list(call=call,prior=prior,cond.probs=cond.probs)    
}

predict.mnb <- function (model,dtm) {
    classlabels <- dimnames(model$cond.probs)[[2]]
    logprobs <- dtm %*% log(model$cond.probs)
    N <- nrow(dtm)
    nclass <- ncol(model$cond.probs)
    logprobs <- logprobs+matrix(nrow=N,ncol=nclass,log(model$prior),byrow=T)
    classlabels[max.col(logprobs)]
}
```